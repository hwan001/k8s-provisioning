repositories:
  - name: istio
    url: https://istio-release.storage.googleapis.com/charts
  - name: fluxcd-community
    url: https://fluxcd-community.github.io/helm-charts
  - name: metrics-server
    url: https://kubernetes-sigs.github.io/metrics-server/
  - name: metallb
    url: https://metallb.github.io/metallb
  - name: actions-runner-controller
    url: https://actions-runner-controller.github.io/actions-runner-controller
  - name: harbor
    url: https://helm.goharbor.io
  - name: n8n
    url: https://community-charts.github.io/helm-charts
  - name: kiali
    url: https://kiali.org/helm-charts
  - name: jetstack
    url: https://charts.jetstack.io

releases:
  - name: istio-base
    namespace: istio-system
    chart: istio/base
    labels:
      app: istio

  - name: istiod
    namespace: istio-system
    chart: istio/istiod
    values:
      - values/istiod-values.yaml
    labels:
      app: istio

  - name: ingress
    namespace: istio-ingress
    chart: istio/gateway
    values:
      - values/ingress-values.yaml
    labels:
      app: istio

  - name: flux
    namespace: flux-system
    chart: fluxcd-community/flux2
    version: 2.16.3 # 2025-07-30
    values:
      - values/flux-values.yaml
    labels:
      app: fluxcd

  - name: metrics-server
    namespace: kube-system
    chart: metrics-server/metrics-server
    values:
      - values/metrics-server-values.yaml
    labels:
      app: metrics-server

  # - name: cert-manager
  #   namespace: cert-manager
  #   chart: jetstack/cert-manager
  #   version: v1.14.3
  #   createNamespace: true
  #   values:
  #     - values/cert-manager-values.yaml
  #   labels:
  #     app: cert-manager
      
  - name: metallb
    namespace: metallb-system
    chart: metallb/metallb
    version: 0.15.2 # 2025-07-30
    createNamespace: true
    values:
      - values/metallb-values.yaml
    labels:
      app: metallb
    hooks:
      - events: ["postApply"]
        showlogs: true
        command: "kubectl"
        args:
          - "apply"
          - "-n"
          - "metallb-system"
          - "-f"
          - "config/metallb-config.yaml"

  # - name: arc
  #   namespace: actions-runner-system
  #   chart: actions-runner-controller/actions-runner-controller
  #   version: 0.23.7 # 2025-08-05
  #   createNamespace: true
  #   values:
  #     - values/arc-values.yaml
  #   labels:
  #     app: arc
  #   needs:
  #     - cert-manager/cert-manager

  - name: harbor
    namespace: harbor-system
    chart: harbor/harbor
    version: 1.17.1 # 2025-08-05
    createNamespace: true
    values:
      - values/harbor-values.yaml
    labels:
      app: harbor

  - name: n8n
    namespace: n8n
    chart: n8n/n8n
    version: 1.5.11 # 2025-07-30
    createNamespace: true
    values:
      - values/n8n-values.yaml
    labels:
      app: n8n
      istio-injection: "enabled"

  - name: kiali
    namespace: istio-system
    chart: kiali/kiali-server
    createNamespace: true
    values:
      - values/kiali-values.yaml
    labels:
      app: kiali
